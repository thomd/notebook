services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: notebook-frontend
    ports:
      - "80:80"
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: notebook-backend
    env_file: .env.prod
    ports:
      - '8000:8000'
    volumes:
      - "~/.notebook:/data"
    restart: "no"
    secrets:
      - notebook_ssh_key
  elasticsearch:
    image: elasticsearch:8.9.0
    ports:
     - "9200:9200"
    container_name: notebook-elasticsearch
    environment:
      SERVER_NAME: "elasticsearch"
      ES_JAVA_OPTS: "-Xms512m -Xmx512m"
      network.bind_host: 0.0.0.0
      network.host: 0.0.0.0
      discovery.type: single-node
      xpack.security.enabled: false
      http.cors.enabled: true
      http.cors.allow-origin: "http://localhost:3000"
      http.cors.allow-headers: "X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorization,x-elastic-client-meta"
      http.cors.allow-credentials: true
secrets:
  notebook_ssh_key:
    file: ~/.ssh/notebook
